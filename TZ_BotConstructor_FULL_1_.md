# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Платформа-конструктор ботов для мессенджеров

**Версия:** 1.0  
**Дата:** 12.02.2026  
**Проект:** BotConstructor Platform

---

## EXECUTIVE SUMMARY

**Платформа BotConstructor** — это облачный SaaS-сервис для создания, хостинга и управления чат-ботами для мессенджеров Telegram и Max с возможностью расширения на другие платформы.

**Ключевые особенности:**
- ✅ No-code визуальный конструктор (drag-and-drop)
- ✅ AI-генерация ботов по текстовому описанию
- ✅ 50+ готовых шаблонов для разных ниш
- ✅ Маркетплейс с реферальной программой
- ✅ Мощная система аналитики
- ✅ Гибкая тарифная сетка (от бесплатного до Enterprise)

**Технологии:** ASP.NET Core MVC 9+, MySQL, Bootstrap 5+, Docker

---

## СОДЕРЖАНИЕ

**ЧАСТЬ 1: ОБЩАЯ ИНФОРМАЦИЯ**
1. Описание проекта
2. Технический стек
3. Типы пользователей

**ЧАСТЬ 2: ФУНКЦИОНАЛЬНЫЕ МОДУЛИ**
4. Аутентификация и авторизация
5. Тарифы и биллинг
6. Конструктор ботов (core функционал)
7. AI-генерация
8. Маркетплейс

**ЧАСТЬ 3: ИНТЕГРАЦИИ И АНАЛИТИКА**
9. Мессенджеры (Telegram, Max)
10. Внешние сервисы (CRM, платежи)
11. Аналитика и отчётность

**ЧАСТЬ 4: АРХИТЕКТУРА И РАЗВЕРТЫВАНИЕ**
12. Архитектура приложения
13. База данных
14. Безопасность
15. Развертывание и CI/CD

**ЧАСТЬ 5: UI/UX И ЭТАПЫ**
16. Пользовательский интерфейс
17. План разработки (MVP и фазы)
18. Бюджет и команда

---

# ЧАСТЬ 1: ОБЩАЯ ИНФОРМАЦИЯ

## 1. ОПИСАНИЕ ПРОЕКТА

### 1.1 Цель
Создать платформу, позволяющую людям без навыков программирования создавать функциональных чат-ботов для бизнеса за минуты, а не недели.

### 1.2 Проблема которую решаем
- Создание ботов требует программирования → мы даём no-code решение
- Дорого нанимать разработчиков → шаблоны + AI генерация
- Сложно поддерживать инфраструктуру → мы берём хостинг на себя
- Нет готовых решений для ниш → 50+ шаблонов

### 1.3 Целевая аудитория (4 категории)

**1. Потребители (Bot Owners)** — 80% пользователей
- Малый и средний бизнес
- Предприниматели, фрилансеры
- Маркетологи, SMM-специалисты
- Технический уровень: от новичков до продвинутых

**2. Разработчики шаблонов** — 10%
- Создают готовые решения для маркетплейса
- Зарабатывают на продажах (95% от цены)
- Предлагают кастомную разработку

**3. Реферальщики** — 5%
- Привлекают пользователей за % от платежей
- Блогеры, агентства, партнёры

**4. Администраторы** — 5%
- Владелец платформы и команда
- Модерация, поддержка, управление

### 1.4 Бизнес-модель

**Монетизация:**
1. **Подписки** (основной доход) — ежемесячные платежи от пользователей
2. **Комиссия с маркетплейса** (~5% от продаж шаблонов)
3. **Реферальная программа** (вовлекает партнёров)
4. **Enterprise** (индивидуальные тарифы для крупных клиентов)

**Тарифы:**
- FREE: 0₽ (с ограничениями)
- STARTER: 990₽/мес
- BUSINESS: 2990₽/мес  
- ENTERPRISE: от 9990₽/мес

---

## 2. ТЕХНИЧЕСКИЙ СТЕК

### Backend
```
Framework: ASP.NET Core MVC 9.0+
Language: C# 12+
Architecture: Модульный монолит
API: RESTful + Swagger
```

### Database
```
DBMS: MySQL 8.0+
ORM: Entity Framework Core 9+
Approach: Code First
Pattern: Repository + Unit of Work
```

### Frontend
```
Framework: ASP.NET MVC
CSS: Bootstrap 5.3+
JS: Vanilla JS / jQuery
Drag-Drop: Custom canvas или React Flow
```

### Infrastructure
```
Containerization: Docker + Docker Compose
CI/CD: GitHub Actions / GitLab CI
Hosting: VPS Ubuntu 22.04
Proxy: Nginx
SSL: Let's Encrypt
```

### Background Jobs
```
Job Scheduler: Quartz.NET
Worker Service: Отдельный процесс
Queues: MySQL tables
```

### Кэширование и сессии
```
Cache: IMemoryCache (in-memory)
Sessions: MySQL (персистентные)
```

### Логирование
```
Logger: Serilog
Storage: Файлы + MySQL
Levels: Debug, Info, Warning, Error, Critical
```

### Внешние интеграции

**Мессенджеры:**
- Telegram Bot API
- Max Messenger API

**AI провайдеры:**
- OpenAI (GPT-4, GPT-3.5)
- Anthropic Claude
- Google Gemini

**Платежи:**
- ЮMoney (ЮKassa)
- Тинькофф
- Сбербанк

**Бизнес-системы:**
- AmoCRM
- Bitrix24
- 1C
- Google Sheets

---

## 3. ТИПЫ ПОЛЬЗОВАТЕЛЕЙ

### 3.1 Super Admin (Владелец платформы)

**Полномочия:**
- ✅ Полный доступ ко всем модулям
- ✅ Управление тарифами и ценами
- ✅ Модерация маркетплейса
- ✅ Просмотр всей аналитики
- ✅ Управление серверами
- ✅ Блокировка пользователей

### 3.2 Admin (Администратор)

**Полномочия:**
- ✅ Модерация ботов и шаблонов
- ✅ Управление пользователями
- ✅ Финансовая отчётность
- ✅ Обработка техподдержки
- ✅ Настройка лимитов

### 3.3 Affiliate (Реферальщик)

**Функционал:**
- Реферальная ссылка
- Статистика привлечённых
- Вывод средств

**Условия:**
- Комиссия: 10-15% от платежей
- Период: 24 месяца
- Минимум вывода: 1000₽

### 3.4 Template Developer (Разработчик)

**Функционал:**
- Создание шаблонов
- Публикация в маркетплейс
- Статистика продаж
- Кастомная разработка

**Условия:**
- Комиссия платформы: ~5%
- Выплаты на баланс

### 3.5 User (Bot Owner)

**Функционал:**
- Создание ботов
- Конструктор (drag-drop)
- Покупка шаблонов
- Аналитика
- Управление подпиской

---

# ЧАСТЬ 2: ФУНКЦИОНАЛЬНЫЕ МОДУЛИ

## 4. АУТЕНТИФИКАЦИЯ И АВТОРИЗАЦИЯ

### 4.1 Методы входа

**Email/Password:**
- Регистрация с подтверждением
- Валидация: 8+ символов
- Восстановление пароля
- Хеширование: bcrypt (cost 12)

**OAuth 2.0:**
- Google
- VK  
- Telegram Login Widget

**2FA (двухфакторная):**
- TOTP (Google Authenticator)
- Backup коды

**SSO (для Enterprise):**
- SAML 2.0
- OpenID Connect

### 4.2 Сессии

**Хранение:**
- MySQL (персистентные)
- Время жизни: 30 дней
- Sliding expiration
- Завершение всех сессий

### 4.3 Роли и права (RBAC)

**Роли:**
- SuperAdmin, Admin, Affiliate, Developer, User

**Claims (примеры):**
```
bots.create, bots.edit, bots.delete
templates.publish, templates.moderate
users.manage, users.block
billing.view, analytics.export
```

---

## 5. ТАРИФЫ И БИЛЛИНГ

### 5.1 Тарифные планы

#### FREE
```
Цена: 0₽
Боты: 1
Сообщения: 100/день
Мессенджеры: Telegram
Брендинг: ✅ Обязателен
AI: ❌ Нет
Экспорт: ❌ Нет
Логи: 7 дней
```

#### STARTER — 990₽/мес
```
Боты: 3
Сообщения: 1000/день на бот
Мессенджеры: Telegram + Max
Брендинг: ✅ Можно убрать
AI: 10 запросов/мес
Экспорт: ✅ Да
Логи: 30 дней
Поддержка: Тикеты
```

#### BUSINESS — 2990₽/мес
```
Боты: 10
Сообщения: 10 000/день
Мессенджеры: Все
Брендинг: ❌ Без брендинга
AI: 100 запросов/мес
Функции: Sandbox, версионирование
Интеграции: CRM, Google Sheets
API: 1000 req/час
Логи: 90 дней
Поддержка: Приоритет (8ч)
```

#### ENTERPRISE — от 9990₽/мес
```
Боты: ∞
Сообщения: ∞
Выделенный сервер: При необходимости
White Label: ✅ Полное
AI: ∞
SSO: ✅ Да
SLA: 99.9%
Персональный менеджер: ✅
API: 100K req/час
```

### 5.2 Логика тарифов

**Downgrade (понижение):**
1. Уведомление за 7 дней
2. Урезание функционала
3. Боты сверх лимита → приостановлены
4. Данные сохранены

**Неоплата:**
1. Grace period: 7 дней
2. Приостановка ботов
3. Удаление через 30 дней (с уведомлением)

**Upgrade (повышение):**
1. Мгновенная активация
2. Пересчёт пропорционально

### 5.3 Платежи

**Провайдеры:**
- ЮMoney, Тинькофф, Сбербанк

**Модель:**
- Ежемесячная подписка (автоплатёж)
- Годовая (скидка 15%)

**Обработка:**
- Webhook уведомления
- Email чеки
- История платежей

---

## 6. КОНСТРУКТОР БОТОВ

### 6.1 Визуальный редактор

**Интерфейс (по аналогии с Botpress):**

```
┌─────────────────────────────────────────────┐
│  Top Bar: Название | Тест | Сохранить      │
├───────┬─────────────────────────┬───────────┤
│       │                         │           │
│ Left  │      Canvas             │  Right    │
│ Side  │   (Drag-Drop Flow)      │  Props    │
│       │                         │           │
│ Nodes │                         │  Settings │
│       │                         │           │
├───────┴─────────────────────────┴───────────┤
│  Bottom: Chat Emulator | Logs | Variables  │
└─────────────────────────────────────────────┘
```

**Функции:**
- Drag-Drop узлов
- Соединение стрелками
- Zoom/Pan
- Minimap
- Auto-save (30 сек)
- Undo/Redo
- Copy/Paste
- Export/Import JSON

### 6.2 Типы узлов (Nodes)

**1. Start Node** — точка входа
```
Триггеры: /start, подписка, команда, regex
```

**2. Message Node** — отправка сообщения
```
Типы: Текст, Фото, Видео, Аудио, Документ, Стикер
Настройки: Текст ({{variables}}), кнопки, задержка
```

**3. Question Node** — запрос данных
```
Типы: Текст, Кнопки, Файл, Контакт, Геолокация
Валидация: Regex, тип, длина
Переменная: Сохранение ответа
```

**4. Condition Node** — ветвление
```
Условия: If/Else, сравнение переменных, regex, время
Выходы: Несколько веток
```

**5. Action Node** — действия
```
Типы: HTTP запрос, Email, Database, CRM, Delay, Calc
```

**6. AI Node** — AI ассистент
```
Провайдеры: OpenAI, Claude, Gemini
Настройки: Model, prompt, temperature, context
```

**7. Payment Node** — оплата
```
Создание инвойса, проверка статуса
```

**8. Database Node** — данные
```
Операции: Save, Load, Update, Delete
Scope: User / Bot
```

**9. Router Node** — переходы
```
Переход к flow / узлу / завершение
```

**10. Code Node** — кастомный код
```
Языки: JavaScript, C#
Доступ к контексту и переменным
```

### 6.3 Переменные

**Типы:**

```javascript
// User Variables
user.id, user.first_name, user.phone, user.email

// Session Variables  
session.cart, session.started_at

// Bot Variables
bot.welcome_message, bot.working_hours

// System Variables
system.date, system.time, system.messenger
```

**Использование:**
```
Привет, {{user.first_name}}!
Ваш заказ #{{order.id}} на {{order.total}}₽
```

### 6.4 Шаблоны сообщений

**Категории:**
- Приветствия
- Подтверждения (оплата, заказ)
- Ошибки
- Уведомления
- Прощания

**Возможности:**
- Переменные
- Мультиязычность
- Варианты (A/B)

---

## 7. AI-ГЕНЕРАЦИЯ БОТОВ

### 7.1 Режимы

**Режим 1: Генерация сценария**
```
Вход: Текстовое описание задачи
Выход: Flow диалога (редактируемый)
```

**Режим 2: Полное создание**
```
Вход: Подробное описание + требования
Выход: Готовый бот (flow + тексты + интеграции)
```

### 7.2 Поддерживаемые модели

```
OpenAI: GPT-4 Turbo, GPT-4, GPT-3.5
Anthropic: Claude 3.5 Sonnet, Opus, Haiku  
Google: Gemini 1.5 Pro, Flash
```

### 7.3 AI Node в боте

**Режимы работы:**
1. Информационный (отвечает на вопросы из базы знаний)
2. Консультационный (помогает выбрать)
3. Intent Detection (маршрутизация по намерению)

**Fallback:**
- Если flow не покрывает → AI обрабатывает

---

## 8. МАРКЕТПЛЕЙС

### 8.1 Готовые шаблоны (50+)

**Категории:**

**E-commerce (8):**
1. Интернет-магазин
2. Приём заказов с оплатой
3. Отслеживание доставки
4. Система лояльности
5-8. ...

**Услуги (10):**
9. Запись к врачу
10. Салон красоты
11. СТО
12. Ресторан (бронирование)
13-18. ...

**Образование (5):**
19. Онлайн-курсы
20. Тестирование
21-23. ...

**Недвижимость (5):**
24. Подбор квартир
25. Виртуальный тур
26-28. ...

**HR (5):**
29. Приём резюме
30. Собеседование
31-33. ...

**Клиентский сервис (6):**
34. FAQ
35. Техподдержка 24/7
36-39. ...

**Маркетинг (6):**
40. Квиз-бот
41. Лидогенерация
42-45. ...

**Финансы (4):**
46. Консультант по кредитам
47-49. ...

**Прочие:**
50. Опросы и голосования

### 8.2 Структура шаблона

```
Метаданные:
  - Название, описание, категория
  - Скриншоты, превью, демо
  - Рейтинг, отзывы, установки

Конфигурация:
  - Flow (JSON/XML)
  - Переменные
  - Интеграции
  - Медиа-файлы

Документация:
  - Инструкция по установке
  - Настройка
  - Примеры, FAQ

Цена:
  - Одноразовая оплата
  - 1 оплата = 1 бот
  - Комиссия: ~5%
```

### 8.3 Модерация

**Автоматическая:**
- Сканирование кода
- Проверка ссылок
- Анализ контента
- Проверка на плагиат
- Тестирование работоспособности

**Ручная (при необходимости):**
- Качество
- Соответствие описанию

**Статусы:**
```
Draft → In Review → Approved → Published
                  ↘ Rejected / Suspended
```

---

# ЧАСТЬ 3: ИНТЕГРАЦИИ

## 9. МЕССЕНДЖЕРЫ

### 9.1 Telegram

**Функционал:**
- Сообщения (текст, медиа, стикеры)
- Inline/Reply клавиатуры
- Команды
- Callback queries
- WebApp
- Платежи

**Подключение:**
```
1. @BotFather → получить токен
2. В платформе: вставить токен
3. Webhook устанавливается автоматически
4. Тест → ✅ Подключен
```

**Режимы:**
- Webhook (рекомендуется)
- Long Polling

### 9.2 Max

**Функционал:**
- Текст, медиа
- Кнопки
- Команды (если поддерживается)

**Подключение:**
```
1. Max Developers → создать бота
2. Получить токен
3. Вставить в платформу
4. Webhook
5. Тест
```

### 9.3 Архитектура (расширяемая)

**Паттерн Strategy:**

```csharp
interface IMessengerAdapter
{
    Task SendMessageAsync(BotMessage msg);
    Task<Update> ReceiveUpdateAsync();
    Task SetWebhookAsync(string url);
}

class TelegramAdapter : IMessengerAdapter { }
class MaxAdapter : IMessengerAdapter { }
// Легко добавить WhatsApp, Viber, VK...
```

**Фабрика:**

```csharp
var adapter = factory.Create(bot.MessengerType, bot.Token);
await adapter.SendMessageAsync(message);
```

---

## 10. ВНЕШНИЕ СЕРВИСЫ

### 10.1 CRM

**AmoCRM:**
- Создание сделок, контактов
- Обновление данных
- OAuth

**Bitrix24:**
- Webhook интеграция
- Лиды, сделки, задачи

**1C:**
- HTTP сервисы
- Выгрузка/загрузка данных

### 10.2 Google Sheets

- OAuth 2.0
- Запись/чтение
- Обновление строк

### 10.3 Платёжные системы

**Модель:**
```csharp
interface IPaymentProvider
{
    Task<Payment> CreatePaymentAsync(decimal amount);
    Task<PaymentStatus> CheckStatusAsync(string paymentId);
}
```

**Провайдеры:**
- ЮMoney
- Тинькофф
- Telegram Payments

### 10.4 Email

- SMTP сервер
- Шаблоны писем
- Вложения

### 10.5 Webhooks

**Исходящие:**
- Отправка событий в URL
- Retry: 5 попыток
- HMAC подпись

**Входящие:**
- Приём от внешних систем
- Валидация
- Маршрутизация

---

## 11. АНАЛИТИКА

### 11.1 Метрики для Bot Owner

**Активность:**
- Уникальные пользователи (DAU/WAU/MAU)
- Новые пользователи
- Retention rate
- Churn rate

**Сообщения:**
- Всего, входящие/исходящие
- Среднее на пользователя
- По времени суток/дням

**Конверсии:**
- Воронка диалога
- Drop-off points
- Конверсия в целевое действие

**Производительность:**
- Время ответа
- Ошибки
- Uptime

**География:**
- Страны, города
- Часовые пояса

### 11.2 Конструктор дашбордов

**Виджеты:**
- Counter (счётчик)
- Line/Bar Chart
- Pie Chart
- Table
- Heatmap
- Funnel
- Geo Map

**Функции:**
- Drag-Drop виджетов
- Фильтры (период, сегменты)
- Сохранённые дашборды
- Экспорт (CSV, Excel, PDF)

### 11.3 Аналитика для Admin

**Финансы:**
- Доход (MRR, ARPU, LTV, CAC)
- По тарифам
- Реферальные, комиссии

**Пользователи:**
- Регистрации
- Конверсия Free→Paid
- География

**Техническая:**
- Загрузка серверов
- Активные боты
- Ошибки

**Маркетплейс:**
- Популярные шаблоны
- Продажи
- Рейтинг разработчиков

---

# ЧАСТЬ 4: АРХИТЕКТУРА

## 12. МОДУЛЬНЫЙ МОНОЛИТ

### 12.1 Структура проекта

```
BotConstructor.Platform/
├── src/
│   ├── Web/              # MVC приложение
│   ├── Api/              # REST API
│   ├── Worker/           # Quartz.NET jobs
│   ├── Core/             # Бизнес-логика
│   │   ├── Entities/
│   │   ├── Interfaces/
│   │   ├── Services/
│   │   └── DTOs/
│   ├── Infrastructure/   # EF Core, репозитории
│   ├── Modules/          # Bounded contexts (отдельные проекты)
│   │   ├── BotConstructor.Module.Bots/
│   │   ├── BotConstructor.Module.Billing/
│   │   ├── BotConstructor.Module.Marketplace/
│   │   ├── BotConstructor.Module.Analytics/
│   │   ├── BotConstructor.Module.Messengers/
│   │   ├── BotConstructor.Module.AI/
│   │   ├── BotConstructor.Module.Integrations/
│   │   └── BotConstructor.Module.Support/
│   └── Shared/           # Общие утилиты
├── tests/
├── docker/
└── scripts/
```

### 12.2 Слои

```
Presentation (Web/API)
       ↓
Application (Services, Use Cases)
       ↓
Domain (Entities, Business Rules)
       ↓
Infrastructure (EF Core, External APIs)
```

**Организация модулей:**

Каждый модуль в директории `src/Modules/` представляет собой **отдельный проект** (.csproj), который:
- Имеет свою внутреннюю структуру (Entities, Services, Interfaces, DTOs)
- Регистрирует свои зависимости через метод расширения (например, `AddBotsModule()`)
- Подключается в главном приложении (Web/Api/Worker) через DI
- Может иметь собственные миграции БД, конфигурации и ресурсы
- Изолирован от других модулей (связь только через интерфейсы из Shared/Core)

**Преимущества подхода:**
- Чёткое разделение ответственности
- Возможность независимой разработки модулей
- Упрощённое тестирование
- Возможность повторного использования модулей в других проектах
- Потенциал для микросервисной архитектуры в будущем

### 12.3 Dependency Injection

```csharp
// Program.cs
// Каждый модуль - отдельный проект с методом расширения для регистрации
services.AddBotsModule();
services.AddBillingModule();
services.AddMarketplaceModule();
services.AddAnalyticsModule();
services.AddMessengersModule();
services.AddAIModule();
services.AddIntegrationsModule();
services.AddSupportModule();

// Пример модуля BotConstructor.Module.Bots
// Файл: src/Modules/BotConstructor.Module.Bots/ModuleExtensions.cs
public static class BotsModuleExtensions
{
    public static IServiceCollection AddBotsModule(this IServiceCollection services)
    {
        services.AddScoped<IBotService, BotService>();
        services.AddScoped<IFlowEngine, FlowEngine>();
        services.AddScoped<INodeExecutor, NodeExecutor>();
        // ... другие сервисы модуля
        return services;
    }
}
```

### 12.4 Пример структуры модуля

**BotConstructor.Module.Bots** (отдельный проект):

```
BotConstructor.Module.Bots/
├── BotConstructor.Module.Bots.csproj
├── Entities/
│   ├── Bot.cs
│   ├── BotNode.cs
│   └── BotFlow.cs
├── Services/
│   ├── BotService.cs
│   ├── FlowEngine.cs
│   └── NodeExecutor.cs
├── Interfaces/
│   ├── IBotService.cs
│   ├── IFlowEngine.cs
│   └── INodeExecutor.cs
├── DTOs/
│   ├── BotDto.cs
│   └── FlowDto.cs
├── Repositories/
│   └── BotRepository.cs
├── Validators/
│   └── BotValidator.cs
└── ModuleExtensions.cs  # Регистрация DI
```

**Зависимости модуля:**
- Core (для общих интерфейсов и базовых сущностей)
- Shared (для утилит)
- Infrastructure (для доступа к БД через репозитории)



---

## 13. БАЗА ДАННЫХ

### 13.1 Подход

```
Подход: Code First (EF Core Migrations)
Naming: PascalCase (таблицы и колонки)
Indexes: IX_TableName_ColumnName
Foreign Keys: FK_Table_Referenced_Column
```

### 13.2 Основные таблицы

**Пользователи:**
```
Users, Roles, UserRoles, UserClaims, UserLogins, UserTokens
```

**Тарифы:**
```
SubscriptionPlans, UserSubscriptions, Payments, Invoices
```

**Боты:**
```
Bots, BotVersions, BotFlows, BotNodes, BotConnections
BotVariables, BotSettings
```

**Мессенджеры:**
```
MessengerConnections, BotUsers, BotMessages
BotContexts, BotUserData
```

**Маркетплейс:**
```
Templates, TemplateCategories, TemplatePurchases
TemplateReviews, TemplateRatings
```

**Рефералы:**
```
ReferralLinks, Referrals, ReferralPayouts
```

**Аналитика:**
```
BotAnalytics, AnalyticsEvents, Dashboards, DashboardWidgets
```

**Поддержка:**
```
SupportTickets, TicketMessages, TicketAttachments
KnowledgeBaseArticles
```

**Система:**
```
AuditLogs, Settings, Notifications, BackgroundJobs
```

### 13.3 Multi-tenancy

**Tenant ID:**
- Каждая таблица с пользовательскими данными содержит `TenantId`
- Global Query Filter для автофильтрации

```csharp
modelBuilder.Entity<Bot>()
    .HasQueryFilter(b => b.TenantId == currentUser.Id);
```

### 13.4 Индексы (критичные)

```sql
CREATE INDEX IX_Bots_TenantId ON Bots(TenantId);
CREATE INDEX IX_BotMessages_BotId_CreatedAt ON BotMessages(BotId, CreatedAt DESC);
CREATE INDEX IX_Payments_UserId_CreatedAt ON Payments(UserId, CreatedAt DESC);
```

---

## 14. ОБРАБОТКА СООБЩЕНИЙ

### 14.1 Webhook Handler

```csharp
[HttpPost]
public async Task<IActionResult> TelegramWebhook(string botToken, Update update)
{
    // 1. Валидация токена
    var bot = await _botRepo.GetByTokenAsync(botToken);
    if (bot == null) return NotFound();
    
    // 2. Сохранение в очередь (БД)
    await _queue.EnqueueAsync(new QueuedMessage {
        BotId = bot.Id,
        RawUpdate = JsonSerializer.Serialize(update),
        Status = QueueStatus.Pending
    });
    
    // 3. Быстрый ответ (200 OK)
    return Ok();
}
```

### 14.2 Message Processor (Quartz Job)

```csharp
public class MessageProcessorJob : IJob
{
    public async Task Execute(IJobExecutionContext context)
    {
        var messages = await _queue.GetPendingAsync(100);
        
        await Parallel.ForEachAsync(messages, async (msg, ct) => {
            var engine = await _engineFactory.CreateAsync(msg.BotId);
            var response = await engine.ProcessAsync(msg);
            
            var messenger = _messengerFactory.Create(msg.MessengerType);
            await messenger.SendAsync(response);
            
            msg.Status = QueueStatus.Processed;
            await _queue.UpdateAsync(msg);
        });
    }
}
```

**Расписание:** Каждые 5 секунд

### 14.3 Flow Engine

```csharp
public async Task<BotResponse> ProcessAsync(IncomingMessage msg)
{
    // 1. Контекст пользователя
    var context = await _contextService.GetOrCreateAsync(msg.UserId, msg.BotId);
    
    // 2. Текущий узел
    var currentNode = await _flowService.GetNodeAsync(context.CurrentNodeId);
    
    // 3. Обработка ввода
    var input = ParseUserInput(msg);
    
    // 4. Сохранение в переменные
    await _varService.SaveAsync(context, currentNode.Variables, input);
    
    // 5. Следующий узел
    var nextNode = await _flowService.GetNextNodeAsync(currentNode, input, context);
    
    // 6. Обновление контекста
    context.CurrentNodeId = nextNode.Id;
    await _contextService.UpdateAsync(context);
    
    // 7. Выполнение узла
    return await ExecuteNodeAsync(nextNode, context);
}
```

---

## 15. БЕЗОПАСНОСТЬ

### 15.1 Защита данных

**Шифрование:**
```
Пароли: bcrypt (cost 12)
API ключи: SHA-256
Важные данные в БД: AES-256
HTTPS: TLS 1.2+
```

**Что шифруется:**
- Пароли пользователей
- API ключи интеграций
- Платёжные токены
- Секретные переменные ботов

### 15.2 Защита от атак

**CSRF:** Anti-CSRF токены, SameSite cookies
**XSS:** Экранирование ввода, CSP headers
**SQL Injection:** Параметризованные запросы (EF Core)
**DDoS:** Rate limiting (Nginx + app level)
**Brute Force:** Лимит попыток (5), CAPTCHA, блокировка

### 15.3 Аудит

**Что логируется:**
- Входы (успешные/неудачные)
- Изменения настроек
- Финансовые операции
- API запросы
- Административные действия

**Хранение:**
```
Файлы: /var/log/botplatform/
БД: таблица audit_logs
Ротация: ежедневно
Хранение: 90 дней (по тарифу)
```

---

## 16. РЕЗЕРВНОЕ КОПИРОВАНИЕ

### 16.1 Автоматические бэкапы

**Что бэкапится:**
- MySQL dump
- Конфигурации ботов
- Медиа-файлы
- Логи
- Настройки

**Расписание:**
```
Полный: еженедельно (вс, 03:00)
Инкрементальный: ежедневно (03:00)
БД: каждые 6 часов
```

**Хранение:**
```
Локально (VPS): 7 дней
Удалённо (S3): 30 дней
Архив: ежемесячные за год
```

### 16.2 Восстановление

```
RTO (Recovery Time): 4 часа
RPO (Recovery Point): 6 часов
```

**Процедура:**
1. Выбор точки восстановления
2. Восстановление в test
3. Проверка
4. Применение к production

---

# ЧАСТЬ 5: UI/UX И ПЛАН

## 17. ПОЛЬЗОВАТЕЛЬСКИЙ ИНТЕРФЕЙС

### 17.1 Дизайн-система

**Framework:** Bootstrap 5.3+

**Палитра:**
```
Primary: #007bff (синий)
Success: #28a745 (зелёный)
Danger: #dc3545 (красный)
Warning: #ffc107 (жёлтый)
```

**Типографика:**
```
Font: System fonts
Size: 14px base, 12px small, 16px large
```

**Иконки:** Bootstrap Icons / Font Awesome

### 17.2 Основные страницы

**1. Лендинг:**
- Hero
- Возможности
- Тарифы
- Шаблоны
- Отзывы
- FAQ

**2. Регистрация/Вход:**
- Email/Password
- OAuth кнопки
- 2FA (если включен)

**3. Dashboard:**
- Виджеты статистики
- Список ботов (карточки)
- Быстрые действия

**4. Конструктор бота:**
```
Top Bar | Left Sidebar | Canvas | Right Props | Bottom Panel
```

**5. Настройки бота:**
- Общие
- Мессенджеры
- Переменные
- Интеграции
- AI
- Лимиты

**6. Аналитика:**
- Конструктор дашбордов
- Виджеты
- Фильтры
- Экспорт

**7. Маркетплейс:**
- Поиск/фильтры
- Категории
- Карточка шаблона

**8. Биллинг:**
- Тариф
- Использование
- Смена тарифа
- Рефералка

**9. Поддержка:**
- База знаний
- Тикеты

### 17.3 Адаптивность

**Breakpoints (Bootstrap):**
```
xs: <576px (mobile)
md: ≥768px (tablet)
lg: ≥992px (desktop) - приоритет
```

**Приоритет:** Desktop-first
**Редактор:** Оптимизирован для desktop
**Мобильная:** Просмотр статистики, управление

---

## 18. ПЛАН РАЗРАБОТКИ

### 18.1 MVP (3 месяца)

**Цель:** Запуск базового функционала с полноценной системой управления

**Принцип разработки:** Каждый модуль разрабатывается полностью (backend + frontend + админка + тестирование), прежде чем переходить к следующему. Это исключает технический долг и необходимость возвращаться к доработкам.

---

#### 1. ✅ Аутентификация и управление пользователями
**1.1 Email/Password аутентификация пользователей**
- Регистрация с email подтверждением
- Вход в систему
- Валидация (8+ символов, сложность пароля)
- Хеширование bcrypt (cost 12)
- Восстановление пароля через email
- Логирование попыток входа

**1.2 Админка для управления пользователями**
- Список всех пользователей (таблица с фильтрами)
- Поиск по email, ID, дате регистрации
- Просмотр профиля пользователя
- Блокировка/разблокировка аккаунтов
- Удаление пользователей (с подтверждением)
- История входов и активности
- Ручное подтверждение email
- Сброс пароля пользователю
- Назначение прав пользователю

**1.3 Личный кабинет пользователя**
- Профиль (редактирование имени, email)
- Смена пароля
- Настройки уведомлений
- Просмотр активных сессий
- Завершение всех сессий
- Удаление аккаунта (с подтверждением)

**1.4 Тестирование модуля**
- Unit-тесты валидации
- Integration-тесты регистрации/входа
- E2E тесты всех сценариев
- Проверка безопасности (попытки взлома)

---

#### 2. ✅ Система тарифов и биллинг
**2.1 Управление тарифными планами**
- Модели данных тарифов (FREE, STARTER)
- Логика лимитов (боты, сообщения, функции)
- Проверка лимитов при действиях
- Миграции БД для тарифов
- Seed данных (начальные тарифы)

**2.2 Интеграция платёжной системы (ЮMoney)**
- Подключение API провайдера
- Создание платежа
- Webhook обработка
- Обновление статуса подписки
- История платежей
- Email-чеки

**2.3 Админка управления подписками**
- Список всех подписок
- Фильтрация по статусу, тарифу, дате
- Просмотр деталей подписки
- Ручная активация/деактивация
- Продление подписки пользователю
- Изменение тарифа вручную
- История платежей пользователя
- Статистика по доходам

**2.4 Личный кабинет - биллинг**
- Текущий тариф и лимиты
- Использование ресурсов (прогресс-бары)
- Смена тарифа (upgrade/downgrade)
- История платежей
- Скачивание чеков
- Автопродление (вкл/выкл)
- Предупреждения о превышении лимитов

**2.5 Тестирование модуля**
- Unit-тесты логики тарифов
- Тесты webhook-обработчиков
- Проверка downgrade/upgrade сценариев
- Тестирование grace period
- E2E оплаты (тестовые платежи)

---

#### 3. ✅ Конструктор ботов (визуальный редактор)
**3.1 Backend API для ботов**
- CRUD операции ботов (Create, Read, Update, Delete)
- Модель данных бота
- Хранение JSON конфигурации flow
- Валидация структуры flow
- Версионирование (базовое)
- API endpoints для редактора

**3.2 Визуальный редактор (Canvas)**
- Drag-and-Drop интерфейс
- Библиотека узлов (левая панель)
- Canvas с zoom/pan
- Соединение узлов стрелками
- Свойства узла (правая панель)
- Auto-save (каждые 30 сек)
- Undo/Redo
- Copy/Paste узлов
- Minimap
- Валидация связей

**3.3 Базовые узлы (4 типа)**
- **Start Node** - точка входа (/start)
- **Message Node** - отправка текста с кнопками
- **Question Node** - запрос данных от пользователя
- **Condition Node** - ветвление логики
- Редакторы для каждого типа узла
- Предпросмотр узлов

**3.4 Sandbox тестирование**
- Эмулятор чата (bottom panel)
- Симуляция диалога
- Просмотр переменных в реальном времени
- Логи выполнения
- Сброс тестового контекста
- Режим отладки (шаг за шагом)

**3.5 Админка управления ботами**
- Список всех ботов платформы
- Фильтры (по владельцу, статусу, дате)
- Просмотр конфигурации любого бота
- Включение/выключение бота
- Удаление ботов (с подтверждением)
- Статистика по ботам
- Доступ к логам ботов
- Модерация (если бот публичный)

**3.6 Личный кабинет - мои боты**
- Список моих ботов (карточки)
- Создание нового бота
- Редактирование бота
- Дублирование бота
- Удаление бота
- Статус бота (активен/остановлен)
- Быстрый переход в редактор
- Поиск по названию

**3.7 Тестирование модуля**
- Unit-тесты CRUD операций
- Тесты валидации flow
- UI-тесты редактора
- Тесты Sandbox эмулятора
- Проверка сохранения/загрузки
- Стресс-тесты (большие flow)

---

#### 4. ✅ Telegram интеграция
**4.1 Подключение Telegram Bot API**
- Регистрация webhook
- Получение обновлений (updates)
- Парсинг входящих сообщений
- Отправка сообщений
- Отправка медиа
- Работа с кнопками (Inline, Reply)
- Обработка callback_query

**4.2 Webhook обработка и очередь**
- Endpoint для Telegram webhook
- Сохранение в очередь (MySQL)
- Background worker (Quartz.NET)
- Обработка очереди (каждые 5 сек)
- Retry логика при ошибках
- Dead letter queue
- Мониторинг очереди

**4.3 Flow Engine (движок выполнения)**
- Контекст пользователя (текущий узел)
- Парсинг ввода пользователя
- Сохранение в переменные
- Переход к следующему узлу
- Выполнение узла
- Отправка ответа
- Логирование всех шагов

**4.4 Настройки бота - Telegram**
- Поле для Bot Token
- Проверка валидности токена
- Установка webhook
- Просмотр информации о боте (@username)
- Удаление webhook
- Логи Telegram API ошибок

**4.5 Админка мониторинга мессенджеров**
- Список всех подключённых ботов
- Статус webhook (активен/ошибка)
- Статистика сообщений (отправлено/получено)
- Логи ошибок API
- Ручная переустановка webhook
- Тестовая отправка сообщения

**4.6 Тестирование модуля**
- Unit-тесты парсинга updates
- Тесты Flow Engine
- Интеграционные тесты с Telegram API
- E2E сценарии диалогов
- Нагрузочные тесты очереди
- Проверка обработки ошибок

---

#### 5. ✅ Базовая аналитика
**5.1 Сбор метрик**
- Модели данных (BotMetrics, UserMetrics)
- Логирование событий (сообщения, переходы)
- Агрегация данных (ежедневно)
- Счётчики (активные пользователи, сессии)
- Фильтрация по периоду

**5.2 Dashboard для владельца бота**
- Виджеты (всего пользователей, активных, сообщений)
- График сообщений (по дням)
- Топ популярных узлов
- Конверсионная воронка (начало → цель)
- Экспорт в CSV

**5.3 Админка - общая аналитика**
- Статистика по всей платформе
- Количество пользователей/ботов
- Доход (общий, по тарифам)
- Самые активные боты
- Использование ресурсов (сообщения, лимиты)
- Динамика роста
- Экспорт отчётов

**5.4 Тестирование модуля**
- Тесты сбора метрик
- Проверка агрегации
- Валидация графиков
- Тесты экспорта данных

---

#### 6. ✅ Система поддержки (тикеты)
**6.1 Backend для тикетов**
- Модели (Ticket, TicketMessage, TicketCategory)
- CRUD операции
- Статусы (New, InProgress, Resolved, Closed)
- Приоритеты (Low, Normal, High, Critical)
- Назначение на админа
- Уведомления (email)

**6.2 Личный кабинет - мои тикеты**
- Список моих тикетов
- Создание нового тикета (тема, категория, описание)
- Просмотр тикета
- Добавление сообщений
- Вложения (скриншоты)
- Закрытие тикета
- Оценка решения

**6.3 Админка управления тикетами**
- Список всех тикетов
- Фильтры (статус, приоритет, дата, назначенный)
- Поиск по тексту
- Открытие тикета
- Ответ на тикет
- Внутренние заметки (не видны юзеру)
- Изменение статуса/приоритета
- Назначение на другого админа
- Массовые действия (закрыть, назначить)
- Шаблоны ответов

**6.4 База знаний (FAQ)**
- Редактор статей (Markdown)
- Категории статей
- Публикация/снятие с публикации
- Поиск по статьям
- Просмотр популярных статей
- Админка для управления FAQ

**6.5 Тестирование модуля**
- Unit-тесты CRUD тикетов
- Тесты уведомлений
- E2E создание/ответ/закрытие
- Проверка прав доступа

---

#### 7. ✅ Инфраструктура и развёртывание
**7.1 Docker конфигурация**
- Dockerfile для Web
- Dockerfile для API
- Dockerfile для Worker
- docker-compose.yml
- Переменные окружения (.env)
- Volume для БД и логов

**7.2 CI/CD Pipeline**
- GitHub Actions / GitLab CI
- Build образов
- Push в Docker Registry
- Deploy на VPS через SSH
- Автоматические миграции БД
- Health check после деплоя

**7.3 VPS настройка**
- Ubuntu 22.04 LTS
- Nginx (reverse proxy)
- SSL сертификаты (Let's Encrypt)
- Firewall (UFW)
- Мониторинг (htop, logs)
- Автоматические бэкапы БД

**7.4 Тестирование модуля**
- Проверка сборки Docker
- Smoke tests после деплоя
- SSL проверка
- Performance тесты (начальная нагрузка)

---

**Не в MVP:**
- Max мессенджер
- AI генерация ботов
- Маркетплейс
- Реферальная программа
- CRM интеграции
- OAuth аутентификация
- Дополнительные узлы (API, Delay, Random, AI)
- Продвинутая аналитика

**Команда MVP:**
```
1x Backend Developer (C#/.NET)
1x Frontend Developer (Bootstrap/JS)
0.5x DevOps Engineer
1x Product Owner
0.5x QA Engineer
```

---

### 18.2 Фаза 2 (2 месяца)

**Цель:** Расширение функционала и улучшение UX

---

#### 8. ✅ Max мессенджер интеграция
**8.1 Подключение Max API**
- Изучение Max Messenger API
- Webhook регистрация
- Парсинг updates
- Отправка сообщений
- Адаптация Flow Engine

**8.2 Админка Max мессенджера**
- Мониторинг Max ботов
- Статистика
- Управление webhook

**8.3 Настройки бота - Max**
- Поле для Max API ключа
- Проверка подключения
- Логи ошибок

**8.4 Тестирование**
- Интеграционные тесты
- E2E сценарии

---

#### 9. ✅ AI узел (OpenAI/Claude)
**9.1 Backend AI интеграции**
- Подключение OpenAI API
- Подключение Anthropic Claude API
- Модель AI узла (промпт, модель, параметры)
- Обработка ответа
- Лимиты запросов по тарифу
- Кэширование частых запросов

**9.2 AI Node в редакторе**
- Новый тип узла "AI Assistant"
- Настройки (выбор модели, температура, max tokens)
- Редактор промпта с переменными
- Предпросмотр
- Тестирование в Sandbox

**9.3 Админка управления AI**
- Статистика использования AI (запросы, токены)
- Лимиты по тарифам
- Блокировка злоупотреблений
- Расходы на API (мониторинг бюджета)

**9.4 Личный кабинет - AI использование**
- Счётчик запросов
- История AI запросов
- Расход токенов

**9.5 Тестирование**
- Unit-тесты AI вызовов
- Проверка лимитов
- E2E сценарии с AI

---

#### 10. ✅ Дополнительные узлы
**10.1 API Request Node**
- Внешние HTTP запросы (GET, POST)
- Headers, Body, Auth
- Парсинг ответа (JSON, XML)
- Сохранение в переменные

**10.2 Delay Node**
- Задержка выполнения
- Настройка времени (секунды, минуты)

**10.3 Random Node**
- Случайный выбор пути
- Веса вероятности

**10.4 Тестирование**
- Тесты каждого узла
- E2E сценарии

---

#### 11. ✅ OAuth аутентификация
**11.1 Google OAuth**
- Настройка Google OAuth 2.0
- Кнопка "Войти через Google"
- Связывание с существующим аккаунтом
- Регистрация через Google

**11.2 VK OAuth**
- Настройка VK OAuth
- Кнопка "Войти через VK"
- Аналогично Google

**11.3 Telegram Login Widget**
- Интеграция виджета
- Вход через Telegram
- Проверка подписи

**11.4 Админка - OAuth управление**
- Список OAuth подключений пользователей
- Отвязка OAuth методов
- Статистика по провайдерам

**11.5 Личный кабинет - связанные аккаунты**
- Список подключённых OAuth
- Отвязка аккаунта
- Добавление нового метода

**11.6 Тестирование**
- Интеграционные тесты с провайдерами
- E2E сценарии входа

---

#### 12. ✅ Все тарифы (FREE, BUSINESS, ENTERPRISE)
**12.1 Добавление тарифов**
- Настройка тарифов FREE, BUSINESS, ENTERPRISE
- Расширенные лимиты
- Специфичные функции (white label, SSO)

**12.2 Логика downgrade/upgrade**
- Grace period при неоплате
- Уведомления за 7 дней
- Автоматическая приостановка ботов
- Восстановление после оплаты

**12.3 Админка управления всеми тарифами**
- Редактирование параметров тарифов
- Ручное изменение тарифа пользователю
- Статистика по тарифам
- A/B тесты тарифов

**12.4 Личный кабинет - выбор тарифа**
- Сравнение тарифов
- Калькулятор стоимости
- Upgrade/Downgrade с пояснениями

**12.5 Тестирование**
- Тесты всех сценариев переключения
- Проверка лимитов
- Edge cases (неоплата, возврат и тд)

---

#### 13. ✅ Версионирование ботов
**13.1 Backend версионирования**
- Модель BotVersion
- Сохранение snapshot при изменениях
- Откат к версии
- Сравнение версий (diff)

**13.2 UI версионирования**
- Список версий (timeline)
- Предпросмотр версии
- Откат к версии (с подтверждением)
- Теги версий (например, "Stable", "Beta")

**13.3 Тестирование**
- Тесты создания версий
- Тесты отката
- Проверка целостности данных

---

#### 14. ✅ Экспорт/Импорт ботов
**14.1 Экспорт**
- Экспорт flow в JSON
- Скачивание файла
- Форматирование (человекочитаемое)

**14.2 Импорт**
- Загрузка JSON файла
- Валидация структуры
- Импорт с заменой/добавлением
- Предпросмотр перед импортом

**14.3 Тестирование**
- Тесты экспорта/импорта
- Валидация несовместимых файлов
- Миграция старых версий

---

#### 15. ✅ Продвинутая аналитика
**15.1 Расширенные метрики**
- Retention rate (возврат пользователей)
- Время сессии
- Тепловая карта узлов (где застревают)
- Анализ оттока

**15.2 Конструктор дашбордов**
- Кастомные виджеты
- Drag-and-drop размещение
- Фильтры и срезы данных
- Сохранение шаблонов

**15.3 Экспорт отчётов**
- PDF отчёты
- Автоматические email рассылки
- Scheduled reports

**15.4 Тестирование**
- Проверка расчётов метрик
- UI тесты конструктора
- Тесты экспорта

---

**Рефакторинг Фазы 2:**
- Оптимизация производительности (кэширование, индексы БД)
- Покрытие unit-тестами (>80%)
- UX улучшения по фидбеку пользователей
- Документация API (Swagger)
- Код-ревью и рефакторинг

---

### 18.3 Фаза 3 (2 месяца)

**Цель:** Маркетплейс, реферальная система и AI-генерация

---

#### 16. ✅ Маркетплейс шаблонов
**16.1 Backend маркетплейса**
- Модели (Template, TemplateCategory, TemplatePurchase)
- Публикация шаблона
- Покупка шаблона
- Рейтинг и отзывы
- Комиссия платформы (5%)

**16.2 Страница маркетплейса**
- Каталог шаблонов (grid view)
- Фильтры (категория, цена, рейтинг)
- Поиск
- Карточка шаблона (превью, описание, скриншоты)
- Кнопка "Купить" / "Скачать бесплатно"
- Отзывы и рейтинг

**16.3 Админка модерации шаблонов**
- Очередь на модерацию
- Просмотр шаблона (flow preview)
- Одобрение/Отклонение
- Причины отклонения
- Блокировка шаблона при нарушениях
- Статистика продаж

**16.4 Тестирование**
- Unit-тесты покупки
- Проверка комиссий
- E2E сценарии публикации/покупки

---

#### 17. ✅ Личный кабинет разработчика шаблонов
**17.1 Публикация шаблона**
- Форма публикации (название, описание, категория)
- Загрузка скриншотов
- Установка цены
- Preview перед отправкой
- Отправка на модерацию

**17.2 Управление шаблонами**
- Мои шаблоны (опубликованные, на модерации, отклонённые)
- Редактирование шаблона
- Снятие с публикации
- Статистика продаж
- Отзывы на мои шаблоны

**17.3 Выплаты**
- Баланс разработчика
- История продаж
- Запрос на вывод средств
- Минимальная сумма вывода (1000₽)
- Реквизиты для выплат

**17.4 Тестирование**
- E2E публикация и продажа
- Проверка расчёта комиссий
- Тесты выплат

---

#### 18. ✅ Реферальная система
**18.1 Backend реферальной программы**
- Модель Referral (код, пользователь, привлечённые)
- Генерация уникального кода
- Отслеживание регистраций по реф-ссылке
- Расчёт комиссии (10-15% от платежей)
- Период отслеживания (24 месяца)

**18.2 Личный кабинет - реферальная программа**
- Реферальная ссылка
- Статистика (привлечено, заработано)
- История начислений
- Вывод средств (мин. 1000₽)
- Реквизиты для выплат

**18.3 Админка управления рефералами**
- Список всех реферальных кодов
- Статистика по реферралам
- Топ рефералов
- Ручное начисление/списание
- Блокировка при мошенничестве
- Выплаты (одобрение запросов)

**18.4 Тестирование**
- Тесты отслеживания переходов
- Расчёт комиссий
- E2E регистрация по реф-ссылке

---

#### 19. ✅ AI генерация ботов
**19.1 Backend AI генерации**
- Промпт-инжиниринг для генерации flow
- Парсинг AI ответа (структурированный JSON)
- Валидация сгенерированного flow
- Сохранение в бота

**19.2 UI AI генератор**
- Страница "Создать с AI"
- Форма описания бота (текстовое поле)
- Параметры (категория, сложность)
- Кнопка "Сгенерировать"
- Preview сгенерированного flow
- Редактирование перед сохранением
- Сохранение как нового бота

**19.3 Админка мониторинга AI генераций**
- Статистика генераций (успешные/неуспешные)
- Логи ошибок генерации
- Расход токенов
- Примеры сгенерированных ботов

**19.4 Тестирование**
- Юнит-тесты парсинга
- Проверка валидации flow
- E2E генерация различных типов ботов

---

#### 20. ✅ 50 готовых шаблонов
**20.1 Разработка шаблонов**
- Категории: E-commerce, Образование, Здоровье, Развлечения, Бизнес
- По 10 шаблонов в категории
- Профессиональный дизайн flow
- Инструкции по настройке
- Скриншоты/превью

**20.2 Импорт в маркетплейс**
- Загрузка всех 50 шаблонов
- Модерация (самомодерация)
- Публикация (часть платная, часть бесплатная)

**20.3 Тестирование шаблонов**
- Проверка работоспособности каждого
- E2E установка и запуск

---

#### 21. ✅ CRM интеграции
**21.1 AmoCRM интеграция**
- API подключение
- Создание контактов/сделок из бота
- Обновление статуса
- Webhook от CRM (события)

**21.2 Bitrix24 интеграция**
- Аналогично AmoCRM

**21.3 1C интеграция**
- REST API / Web-сервисы
- Синхронизация данных

**21.4 Узел CRM в редакторе**
- Новый тип узла "CRM Action"
- Настройки (выбор CRM, действие, маппинг полей)
- Тестирование в Sandbox

**21.5 Админка мониторинга интеграций**
- Список подключённых CRM
- Статус соединения
- Логи ошибок
- Статистика операций

**21.6 Тестирование**
- Интеграционные тесты с каждой CRM
- E2E создание сделки

---

#### 22. ✅ Google Sheets интеграция
**22.1 Google Sheets API**
- OAuth подключение
- Чтение данных из таблицы
- Запись данных в таблицу
- Обновление строк

**22.2 Узел Google Sheets**
- Новый тип узла
- Настройки (таблица, диапазон, действие)
- Маппинг переменных на колонки

**22.3 Тестирование**
- Интеграционные тесты
- E2E запись в таблицу

---

**Итоги Фазы 3:**
- Полноценный маркетплейс с модерацией
- Реферальная программа для привлечения пользователей
- AI генерация ботов
- 50 готовых шаблонов
- Интеграции с популярными CRM и Google Sheets

---

### 18.4 Фаза 4 (ongoing — постоянное развитие)

**Цель:** Масштабирование и новые функции

---

#### 23. ✅ Новые мессенджеры
**23.1 WhatsApp Business API**
- Подключение API
- Webhook обработка
- Адаптация Flow Engine
- Тестирование

**23.2 Viber Bot API**
- Аналогично WhatsApp

**23.3 Админка управления мессенджерами**
- Универсальная панель для всех мессенджеров
- Статистика
- Мониторинг

---

#### 24. ✅ Дополнительные интеграции
**24.4 Платёжные системы (Stripe, PayPal)**
- Интеграция платёжных узлов в ботов
- Приём оплат через бота

**24.5 Email/SMS рассылки (SendGrid, Twilio)**
- Отправка email/SMS из бота

**24.6 Аналитика (Google Analytics, Yandex Metrica)**
- Трекинг событий из бота

---

#### 25. ✅ Enterprise функции
**25.1 SSO (SAML 2.0, OpenID Connect)**
- Подключение корпоративного SSO
- Настройка для Enterprise клиентов

**25.2 White Label**
- Кастомизация интерфейса (лого, цвета)
- Собственный домен
- Убрать упоминания BotConstructor

**25.3 Выделенные серверы**
- Инфраструктура для Enterprise
- Изоляция данных
- SLA 99.9%

**25.4 Персональный менеджер**
- Назначение менеджера для Enterprise
- Приоритетная поддержка

---

#### 26. ✅ Оптимизация производительности
**26.1 Масштабирование БД**
- Sharding
- Read replicas
- Оптимизация индексов

**26.2 Кэширование**
- Redis для сессий и кэша
- CDN для статики

**26.3 Load Balancing**
- Nginx load balancer
- Kubernetes (при необходимости)

---

#### 27. ✅ Mobile приложения
**27.1 iOS приложение**
- Native Swift или React Native
- Управление ботами
- Просмотр аналитики
- Уведомления

**27.2 Android приложение**
- Аналогично iOS

---

#### 28. ✅ Публичный API
**28.1 REST API для партнёров**
- Документация
- API ключи
- Rate limiting
- SDK (JS, Python)

**28.2 Webhook API**
- Уведомления о событиях
- Кастомная обработка

---

#### 29. ✅ Community форум
**29.1 Форум пользователей**
- Разделы (вопросы, идеи, шаблоны)
- Модерация
- Интеграция с профилем

**29.2 База знаний**
- Расширение FAQ
- Видео-туториалы
- Блог

---

**Непрерывные процессы Фазы 4:**
- Регулярные релизы (раз в 2 недели)
- Сбор фидбека пользователей
- A/B тестирование новых функций
- Мониторинг и улучшение производительности
- Безопасность и аудит
- Расширение команды по мере роста

---

## 19. РАЗВЕРТЫВАНИЕ

### 19.1 Инфраструктура (начальная)

**VPS:**
```
CPU: 4 cores
RAM: 8 GB
SSD: 100 GB
OS: Ubuntu 22.04 LTS
```

**Компоненты:**
```
Nginx (reverse proxy, SSL)
Docker + Docker Compose
MySQL 8.0
.NET 9 Runtime
Certbot (Let's Encrypt)
```

### 19.2 Docker Compose

```yaml
version: '3.8'
services:
  web:
    image: botplatform/web:latest
    ports: ["5000:80"]
    depends_on: [mysql]
    
  api:
    image: botplatform/api:latest
    ports: ["5001:80"]
    depends_on: [mysql]
    
  worker:
    image: botplatform/worker:latest
    depends_on: [mysql]
    
  mysql:
    image: mysql:8.0
    ports: ["3306:3306"]
    volumes: [mysql_data:/var/lib/mysql]
```

### 19.3 CI/CD

**GitHub Actions:**
```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build Docker images
      - name: Push to registry
      - name: SSH deploy to VPS
```

---

## ЗАКЛЮЧЕНИЕ

Это детальное техническое задание описывает все аспекты платформы BotConstructor — от архитектуры и технологий до бизнес-процессов и плана разработки.

**Ключевые моменты:**

✅ **Технологии:** ASP.NET Core MVC 9, MySQL, Bootstrap 5, Docker  
✅ **Архитектура:** Модульный монолит с возможностью масштабирования  
✅ **Функционал:** Визуальный конструктор, AI-генерация, маркетплейс, аналитика  
✅ **Мессенджеры:** Telegram, Max (расширяемо)  
✅ **Безопасность:** Шифрование, RBAC, аудит, бэкапы  
✅ **Монетизация:** Подписки (4 тарифа) + комиссии + реферальная программа  

**Следующие шаги:**

1. Утверждение ТЗ
2. Детализация задач в backlog
3. Оценка времени и бюджета
4. Формирование команды
5. Старт MVP (3 месяца)

---

**Контакты для вопросов:**
[Указать контакты Product Owner]

**Версия документа:** 1.0  
**Дата последнего обновления:** 12.02.2026
